name: Test Automation Chain

on:
  workflow_dispatch:
    inputs:
      test_version:
        description: 'Test version (e.g., 1.99.99-test)'
        required: false
        default: ''
        type: string

jobs:
  test:
    runs-on: ubuntu-latest  
    steps:
    - name: Generate test version
      id: version
      run: |
        if [ -n "${{ github.event.inputs.test_version }}" ]; then
          TEST_VERSION="${{ github.event.inputs.test_version }}"
        else
          TIMESTAMP=$(date +"%Y%m%d-%H%M%S")
          TEST_VERSION="1.99.99-test-${TIMESTAMP}"
        fi
        echo "version=${TEST_VERSION}" >> $GITHUB_OUTPUT
        echo "🧪 Testing automation chain with: ${TEST_VERSION}"
    
    - name: Trigger minecraft-data-generator
      run: |
        echo "🚀 Triggering minecraft-data-generator for test version: ${{ steps.version.outputs.version }}"
        gh workflow run handle-mcdata-update.yml \
          --repo PrismarineJS/minecraft-data-generator \
          -f version="${{ steps.version.outputs.version }}" \
          -f pr_number="TEST" \
          -f issue_number="TEST"
        
        echo "✅ Generator triggered!"
        echo ""
        echo "Expected automation chain:"
        echo "1. 🏭 minecraft-data-generator → generates data"
        echo "2. 📊 minecraft-data → handle-mcpc-generator triggered"
        echo "3. 🔗 node-minecraft-protocol → update workflow triggered" 
        echo "4. 🤖 mineflayer → update workflow triggered"
        echo ""
        echo "🔍 Check for test PRs in all repos in 10-15 minutes:"
        echo "- https://github.com/PrismarineJS/minecraft-data/pulls"
        echo "- https://github.com/PrismarineJS/node-minecraft-protocol/pulls"
        echo "- https://github.com/PrismarineJS/mineflayer/pulls"
        echo "- https://github.com/PrismarineJS/minecraft-data-generator/pulls"
      env:
        GITHUB_TOKEN: ${{ secrets.PAT_PASSWORD }}